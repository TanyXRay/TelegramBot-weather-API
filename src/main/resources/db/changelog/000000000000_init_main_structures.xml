<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <changeSet id="000000000000_create_table_telegram_user" author="Tatyana Chernyadieva">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="telegram_user"/>
            </not>
        </preConditions>

        <sql>
            create table telegram_user
            (
                id integer generated by default as identity primary key,
                nickname varchar(50) not null,
                name varchar(100),
                user_id bigint not null unique
            )
        </sql>
    </changeSet>

    <changeSet id="000000000000_create_table_location" author="Tatyana Chernyadieva">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="location"/>
            </not>
        </preConditions>
        <sql>
            create table location
            (
                id integer generated by default as identity primary key,
                latitude double precision not null,
                longitude double precision not null,
                city      varchar
            )
        </sql>
    </changeSet>

    <changeSet id="000000000000_alter_table_location_add_column_user_id" author="Tatyana Chernyadieva">
    <preConditions onFail="MARK_RAN">
        <not>
            <columnExists tableName="location" columnName="user_id"/>
        </not>
    </preConditions>
    <sql>
        alter table location add column user_id bigint references telegram_user (user_id) on delete cascade
    </sql>
    </changeSet>

</databaseChangeLog>
